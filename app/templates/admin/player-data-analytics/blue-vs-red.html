{% extends "base.html" %}

{% block title %}Blue vs Red Team Analytics - CyberQuest Admin{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 dark:bg-gray-900 py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        {% include 'admin/components/dynamic_breadcrumb.html' %}
        
        <!-- Header -->
        <div class="mb-8 opacity-0 animate-fade-in-up" style="animation-delay: 0.1s;">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900 dark:text-white">‚öîÔ∏è Blue vs Red Team Analytics</h1>
                    <p class="text-gray-700 dark:text-gray-300 mt-2">Performance metrics for cybersecurity simulation battles</p>
                </div>
                <div class="flex space-x-3">
                    <a href="{{ url_for('admin.dashboard') }}" 
                       class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-all duration-300 hover:scale-105 hover:shadow-lg">
                        <i class="bi bi-speedometer2 mr-2"></i>Admin Dashboard
                    </a>
                    <a href="{{ url_for('data_analytics.player_analytics') }}" 
                       class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition-all duration-300 hover:scale-105 hover:shadow-lg">
                        <i class="bi bi-arrow-left mr-2"></i>Back to Analytics
                    </a>
                </div>
            </div>
        </div>

        <!-- Overview Stats -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8 opacity-0 animate-fade-in-up" style="animation-delay: 0.2s;">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 border border-gray-200 dark:border-gray-700 hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <i class="bi bi-controller text-blue-500 text-2xl"></i>
                    </div>
                    <div class="ml-4">
                        <dt class="text-sm font-medium text-gray-700 dark:text-gray-300">Total Games</dt>
                        <dd class="text-2xl font-bold text-gray-900 dark:text-white">{{ blue_vs_red_data.overview.total_games }}</dd>
                    </div>
                </div>
            </div>

            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 border border-gray-200 dark:border-gray-700 hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <i class="bi bi-clock text-green-500 text-2xl"></i>
                    </div>
                    <div class="ml-4">
                        <dt class="text-sm font-medium text-gray-700 dark:text-gray-300">Avg Game Duration</dt>
                        <dd class="text-2xl font-bold text-gray-900 dark:text-white">{{ (blue_vs_red_data.overview.avg_game_duration / 60) | round(1) }}m</dd>
                    </div>
                </div>
            </div>

            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 border border-gray-200 dark:border-gray-700 hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <i class="bi bi-shield-check text-blue-500 text-2xl"></i>
                    </div>
                    <div class="ml-4">
                        <dt class="text-sm font-medium text-gray-700 dark:text-gray-300">Player Win Rate</dt>
                        <dd class="text-2xl font-bold text-gray-700 dark:text-gray-300">{{ blue_vs_red_data.overview.player_win_rate }}%</dd>
                    </div>
                </div>
            </div>

            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 border border-gray-200 dark:border-gray-700 hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <i class="bi bi-server text-purple-500 text-2xl"></i>
                    </div>
                    <div class="ml-4">
                        <dt class="text-sm font-medium text-gray-700 dark:text-gray-300">Asset Protection</dt>
                        <dd class="text-2xl font-bold text-gray-700 dark:text-gray-300">{{ blue_vs_red_data.overview.asset_protection_rate }}%</dd>
                    </div>
                </div>
            </div>
        </div>

        <!-- Performance Metrics -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8 opacity-0 animate-fade-in-up" style="animation-delay: 0.3s;">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 border border-gray-200 dark:border-gray-700 hover:shadow-xl transition-all duration-300">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">üõ°Ô∏è Defense Performance</h3>
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-700 dark:text-gray-300">Threat Detection Speed</span>
                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">{{ blue_vs_red_data.performance_metrics.threat_detection_speed }}s</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-700 dark:text-gray-300">Incident Response Effectiveness</span>
                        <div class="flex items-center">
                            <div class="w-24 bg-gray-200 dark:bg-gray-700 rounded-full h-2 mr-3">
                                <div class="bg-green-500 h-2 rounded-full" style="width: {{ blue_vs_red_data.performance_metrics.incident_response_effectiveness }}%"></div>
                            </div>
                            <span class="text-sm font-medium text-gray-900 dark:text-white">{{ blue_vs_red_data.performance_metrics.incident_response_effectiveness }}%</span>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-700 dark:text-gray-300">Security Control Optimization</span>
                        <div class="flex items-center">
                            <div class="w-24 bg-gray-200 dark:bg-gray-700 rounded-full h-2 mr-3">
                                <div class="bg-blue-500 h-2 rounded-full" style="width: {{ blue_vs_red_data.performance_metrics.security_control_optimization }}%"></div>
                            </div>
                            <span class="text-sm font-medium text-gray-900 dark:text-white">{{ blue_vs_red_data.performance_metrics.security_control_optimization }}%</span>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-700 dark:text-gray-300">Alert Prioritization Accuracy</span>
                        <div class="flex items-center">
                            <div class="w-24 bg-gray-200 dark:bg-gray-700 rounded-full h-2 mr-3">
                                <div class="bg-purple-500 h-2 rounded-full" style="width: {{ blue_vs_red_data.performance_metrics.alert_prioritization_accuracy }}%"></div>
                            </div>
                            <span class="text-sm font-medium text-gray-900 dark:text-white">{{ blue_vs_red_data.performance_metrics.alert_prioritization_accuracy }}%</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 border border-gray-200 dark:border-gray-700 hover:shadow-xl transition-all duration-300">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">‚öîÔ∏è Attack Metrics</h3>
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-700 dark:text-gray-300">AI Attack Success Rate</span>
                        <div class="flex items-center">
                            <div class="w-24 bg-gray-200 dark:bg-gray-700 rounded-full h-2 mr-3">
                                <div class="bg-red-500 h-2 rounded-full" style="width: {{ blue_vs_red_data.performance_metrics.ai_attack_success_rate }}%"></div>
                            </div>
                            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">{{ blue_vs_red_data.performance_metrics.ai_attack_success_rate }}%</span>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-700 dark:text-gray-300">Player Action Efficiency</span>
                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">{{ (blue_vs_red_data.performance_metrics.player_action_efficiency * 100) | round(1) }}%</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-700 dark:text-gray-300">Mean Time to Detection (MTTD)</span>
                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">{{ blue_vs_red_data.performance_metrics.mttd }}s</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-700 dark:text-gray-300">Mean Time to Response (MTTR)</span>
                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">{{ blue_vs_red_data.performance_metrics.mttr }}s</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-700 dark:text-gray-300">Recovery Time Objective (RTO)</span>
                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">{{ blue_vs_red_data.performance_metrics.rto }}s</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Asset Protection Breakdown -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-8 border border-gray-200 dark:border-gray-700 hover:shadow-xl transition-all duration-300 opacity-0 animate-fade-in-up" style="animation-delay: 0.4s;">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-6">ÔøΩÔ∏è Asset Protection Rates</h3>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div class="text-center hover:scale-105 transition-transform duration-300">
                    <div class="text-sm text-gray-700 dark:text-gray-300 mb-2">Academy Server</div>
                    <div class="relative">
                        <div class="w-20 h-20 mx-auto">
                            <svg class="w-20 h-20 transform -rotate-90" viewBox="0 0 36 36">
                                <path class="text-gray-300 dark:text-gray-600"
                                      stroke="currentColor" stroke-width="3" fill="none"
                                      d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                <path class="text-green-600" stroke="currentColor" stroke-width="3" fill="none"
                                      stroke-dasharray="{{ blue_vs_red_data.asset_protection.academy_server }}, 100"
                                      d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                            </svg>
                        </div>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <span class="text-sm font-semibold text-gray-900 dark:text-white">{{ blue_vs_red_data.asset_protection.academy_server }}%</span>
                        </div>
                    </div>
                </div>

                <div class="text-center hover:scale-105 transition-transform duration-300">
                    <div class="text-sm text-gray-700 dark:text-gray-300 mb-2">Student Database</div>
                    <div class="relative">
                        <div class="w-20 h-20 mx-auto">
                            <svg class="w-20 h-20 transform -rotate-90" viewBox="0 0 36 36">
                                <path class="text-gray-300 dark:text-gray-600"
                                      stroke="currentColor" stroke-width="3" fill="none"
                                      d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                <path class="text-blue-600" stroke="currentColor" stroke-width="3" fill="none"
                                      stroke-dasharray="{{ blue_vs_red_data.asset_protection.student_db }}, 100"
                                      d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                            </svg>
                        </div>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <span class="text-sm font-semibold text-gray-900 dark:text-white">{{ blue_vs_red_data.asset_protection.student_db }}%</span>
                        </div>
                    </div>
                </div>

                <div class="text-center hover:scale-105 transition-transform duration-300">
                    <div class="text-sm text-gray-700 dark:text-gray-300 mb-2">Research Files</div>
                    <div class="relative">
                        <div class="w-20 h-20 mx-auto">
                            <svg class="w-20 h-20 transform -rotate-90" viewBox="0 0 36 36">
                                <path class="text-gray-300 dark:text-gray-600"
                                      stroke="currentColor" stroke-width="3" fill="none"
                                      d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                <path class="text-orange-600" stroke="currentColor" stroke-width="3" fill="none"
                                      stroke-dasharray="{{ blue_vs_red_data.asset_protection.research_files }}, 100"
                                      d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                            </svg>
                        </div>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <span class="text-sm font-semibold text-gray-900 dark:text-white">{{ blue_vs_red_data.asset_protection.research_files }}%</span>
                        </div>
                    </div>
                </div>

                <div class="text-center hover:scale-105 transition-transform duration-300">
                    <div class="text-sm text-gray-700 dark:text-gray-300 mb-2">Learning Platform</div>
                    <div class="relative">
                        <div class="w-20 h-20 mx-auto">
                            <svg class="w-20 h-20 transform -rotate-90" viewBox="0 0 36 36">
                                <path class="text-gray-300 dark:text-gray-600"
                                      stroke="currentColor" stroke-width="3" fill="none"
                                      d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                <path class="text-purple-600" stroke="currentColor" stroke-width="3" fill="none"
                                      stroke-dasharray="{{ blue_vs_red_data.asset_protection.learning_platform }}, 100"
                                      d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                            </svg>
                        </div>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <span class="text-sm font-semibold text-gray-900 dark:text-white">{{ blue_vs_red_data.asset_protection.learning_platform }}%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Attack Pattern Analysis -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 border border-gray-200 dark:border-gray-700 hover:shadow-xl transition-all duration-300 opacity-0 animate-fade-in-up" style="animation-delay: 0.5s;">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-6">üéØ Attack Pattern Analysis</h3>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                    <thead class="bg-gray-50 dark:bg-gray-700">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 dark:text-gray-300 uppercase tracking-wider">
                                Attack Phase
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 dark:text-gray-300 uppercase tracking-wider">
                                AI Success Rate
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 dark:text-gray-300 uppercase tracking-wider">
                                Player Detection Rate
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 dark:text-gray-300 uppercase tracking-wider">
                                Defense Effectiveness
                            </th>
                        </tr>
                    </thead>
                    <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                        {% for pattern in blue_vs_red_data.attack_patterns %}
                        <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">
                                {{ pattern.phase.replace('_', ' ').title() }}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                                <div class="flex items-center">
                                    <div class="w-16 bg-gray-200 dark:bg-gray-700 rounded-full h-2 mr-3">
                                        <div class="bg-red-500 h-2 rounded-full" style="width: {{ pattern.success_rate }}%"></div>
                                    </div>
                                    <span class="text-gray-700 dark:text-gray-300">{{ pattern.success_rate }}%</span>
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                                <div class="flex items-center">
                                    <div class="w-16 bg-gray-200 dark:bg-gray-700 rounded-full h-2 mr-3">
                                        <div class="bg-blue-500 h-2 rounded-full" style="width: {{ pattern.detection_rate }}%"></div>
                                    </div>
                                    <span class="text-gray-700 dark:text-gray-300">{{ pattern.detection_rate }}%</span>
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                                {% set effectiveness = 100 - pattern.success_rate %}
                                {% if effectiveness >= 80 %}
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">
                                        Excellent
                                    </span>
                                {% elif effectiveness >= 60 %}
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200">
                                        Good
                                    </span>
                                {% elif effectiveness >= 40 %}
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200">
                                        Fair
                                    </span>
                                {% else %}
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200">
                                        Needs Improvement
                                    </span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

    </div>
</div>
{% endblock %}
