{% extends "base.html" %}

{% block title %}Blue vs Red Team - Dashboard{% endblock %}

{% block extra_css %}
<style>
    /* Custom ring pulse animations for status indicators */
    @keyframes pulse-red {
        0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
        50% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
    }
    @keyframes pulse-green {
        0%, 100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
        50% { box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); }
    }
    .pulse-red { animation: pulse-red 2s infinite; }
    .pulse-green { animation: pulse-green 2s infinite; }
    
    /* Custom scrollbars - Webkit */
    .scrollbar-custom::-webkit-scrollbar { width: 12px; height: 12px; }
    .scrollbar-custom::-webkit-scrollbar-track { background: #1f2937; border-radius: 6px; border: 1px solid #374151; }
    .scrollbar-custom::-webkit-scrollbar-thumb { background: linear-gradient(180deg, #4b5563, #374151); border-radius: 6px; border: 1px solid #6b7280; }
    .scrollbar-custom::-webkit-scrollbar-thumb:hover { background: linear-gradient(180deg, #6b7280, #4b5563); border-color: #9ca3af; }
    .scrollbar-custom::-webkit-scrollbar-thumb:active { background: linear-gradient(180deg, #10b981, #059669); border-color: #10b981; }
    
    .scrollbar-terminal::-webkit-scrollbar { width: 10px; height: 10px; }
    .scrollbar-terminal::-webkit-scrollbar-track { background: #111827; border-radius: 5px; border: 1px solid #1f2937; }
    .scrollbar-terminal::-webkit-scrollbar-thumb { background: linear-gradient(180deg, #374151, #1f2937); border-radius: 5px; border: 1px solid #4b5563; }
    .scrollbar-terminal::-webkit-scrollbar-thumb:hover { background: linear-gradient(180deg, #4b5563, #374151); border-color: #6b7280; }
    .scrollbar-terminal::-webkit-scrollbar-thumb:active { background: linear-gradient(180deg, #10b981, #047857); border-color: #10b981; }
    
    .scrollbar-alerts::-webkit-scrollbar { width: 10px; height: 10px; }
    .scrollbar-alerts::-webkit-scrollbar-track { background: #7f1d1d; border-radius: 5px; border: 1px solid #991b1b; }
    .scrollbar-alerts::-webkit-scrollbar-thumb { background: linear-gradient(180deg, #dc2626, #b91c1c); border-radius: 5px; border: 1px solid #ef4444; }
    .scrollbar-alerts::-webkit-scrollbar-thumb:hover { background: linear-gradient(180deg, #ef4444, #dc2626); border-color: #f87171; }
    .scrollbar-alerts::-webkit-scrollbar-thumb:active { background: linear-gradient(180deg, #10b981, #059669); border-color: #10b981; }
    
    /* Firefox scrollbar */
    .scrollbar-custom { scrollbar-width: thin; scrollbar-color: #4b5563 #1f2937; }
    .scrollbar-terminal { scrollbar-width: thin; scrollbar-color: #374151 #111827; }
    .scrollbar-alerts { scrollbar-width: thin; scrollbar-color: #dc2626 #7f1d1d; }
    
    /* Animations */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .tab-pane.active { animation: fadeIn 0.3s ease; }
    
    @keyframes slideDown {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    #game-menu-dropdown:not(.hidden) { animation: slideDown 0.2s ease-out; }
</style>
{% endblock %}

{% block navbar %}

{% endblock %}

{% block content %}
<div class="min-h-screen bg-black overflow-x-hidden">
    <div class="w-full">
        <!-- Header -->
        <div class="mb-6 flex justify-between items-start bg-gray-800 border-b border-gray-600 p-4">
            <div>
                <h1 class="text-3xl font-bold text-white mb-2">
                    <i class="bi bi-shield-check text-green-400"></i> Blue Team vs Red Team
                </h1>
                <p class="text-gray-300 text-lg">Defend Project Sentinel Academy against adaptive AI attacks</p>
            </div>
            <!-- Game Controls Menu -->
            <div class="relative">
                <button id="game-menu-button" class="flex items-center px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg shadow-sm hover:bg-gray-600 transition-colors cursor-pointer">
                    <i class="bi bi-gear mr-2 text-gray-300"></i>
                    <span class="text-white">Controls</span>
                    <i class="bi bi-chevron-down ml-2 text-gray-400"></i>
                </button>
                
                <!-- Dropdown Menu -->
                <div id="game-menu-dropdown" class="absolute right-0 mt-2 w-48 bg-gray-800 rounded-lg shadow-lg border border-gray-600 z-50 hidden">
                    <div class="py-2">
                        <button id="pause-simulation" class="w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700 flex items-center cursor-pointer">
                            <i class="bi bi-pause-fill mr-2 text-yellow-400"></i>
                            Pause Simulation
                        </button>
                        <button id="stop-simulation" class="w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700 flex items-center cursor-pointer">
                            <i class="bi bi-stop-fill mr-2 text-red-400"></i>
                            Stop Simulation
                        </button>
                        <button id="reset-simulation" class="w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700 flex items-center cursor-pointer">
                            <i class="bi bi-arrow-clockwise mr-2 text-gray-300"></i>
                            Reset Simulation
                        </button>
                        <hr class="my-2 border-gray-600">
                        <button id="exit-simulation" class="w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-gray-700 flex items-center cursor-pointer">
                            <i class="bi bi-box-arrow-left mr-2"></i>
                            Exit to Menu
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Guide Panel -->
        <div id="quick-guide" class="bg-gradient-to-r from-blue-900/30 to-purple-900/30 border-2 border-blue-500 rounded-lg p-4 mb-6">
            <div class="flex items-start justify-between">
                <div class="flex-1">
                    <h3 class="text-lg font-bold text-blue-400 mb-2 flex items-center">
                        <i class="bi bi-info-circle-fill me-2"></i>Quick Guide: How to Play
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-white">
                        <div class="bg-black/30 p-3 rounded border border-blue-500/30">
                            <div class="font-semibold text-blue-300 mb-1">
                                <i class="bi bi-1-circle-fill me-1"></i>Monitor Network
                            </div>
                            <div class="text-gray-300 text-xs">
                                Watch the <span class="text-green-400 font-mono">Network Defense Map</span> for attacks on your assets. Check <span class="text-orange-400">Alert Center</span> for new threats.
                            </div>
                        </div>
                        <div class="bg-black/30 p-3 rounded border border-blue-500/30">
                            <div class="font-semibold text-blue-300 mb-1">
                                <i class="bi bi-2-circle-fill me-1"></i>Use Terminal Commands
                            </div>
                            <div class="text-gray-300 text-xs">
                                Type <span class="text-green-400 font-mono">help</span> in the terminal below to see all commands. Use <span class="text-green-400 font-mono">scan [asset]</span> to investigate and <span class="text-green-400 font-mono">restore [asset]</span> to fix damage.
                            </div>
                        </div>
                        <div class="bg-black/30 p-3 rounded border border-blue-500/30">
                            <div class="font-semibold text-blue-300 mb-1">
                                <i class="bi bi-3-circle-fill me-1"></i>Earn XP & Defend
                            </div>
                            <div class="text-gray-300 text-xs">
                                Respond to incidents quickly to earn XP. Keep assets above 50% integrity. Re-enable disabled security controls immediately!
                            </div>
                        </div>
                    </div>
                </div>
                <button id="close-guide" class="ms-3 text-gray-400 hover:text-white cursor-pointer transition-colors" onclick="document.getElementById('quick-guide').style.display='none'">
                    <i class="bi bi-x-lg text-xl"></i>
                </button>
            </div>
        </div>

        <!-- Game Status Bar -->
        <div class="bg-gray-800 border border-gray-600 p-4 mb-6">
            <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                <div class="flex items-center space-x-3 cursor-help status-indicator" title="Network security status">
                    <div class="w-4 h-4 rounded-full bg-green-400 pulse-green" id="network-status"></div>
                    <span class="text-sm font-medium text-white">Network: <span id="network-text" class="text-green-400">Secure</span></span>
                </div>
                <div class="flex items-center space-x-3 cursor-help status-indicator" title="Asset integrity status">
                    <div class="w-4 h-4 rounded-full bg-green-400" id="assets-status"></div>
                    <span class="text-sm font-medium text-white">Assets: <span id="assets-text" class="text-green-400">Protected</span></span>
                </div>
                <div class="flex items-center space-x-3 cursor-help status-indicator" title="Active security alerts">
                    <div class="w-4 h-4 rounded-full bg-gray-500" id="alerts-status"></div>
                    <span class="text-sm font-medium text-white">Alerts: <span id="alerts-count" class="text-gray-300">0 Active</span></span>
                </div>
                <div class="flex items-center space-x-3 cursor-help status-indicator" title="Experience points earned this session">
                    <i class="bi bi-award text-blue-400"></i>
                    <span class="text-sm font-medium text-white">Session XP: <span id="session-xp" class="text-blue-400">0</span></span>
                </div>
                <div class="flex items-center space-x-3 cursor-help status-indicator" title="Time remaining in simulation">
                    <i class="bi bi-clock text-green-400"></i>
                    <span class="text-sm font-medium text-white">Time: <span id="round-timer" class="text-green-400">15:00</span></span>
                </div>
            </div>
        </div>

        <!-- Main Game Area -->
        <div class="grid grid-cols-1 gap-6">
            <!-- Tabbed Interface for Network Map, Alerts, and System Info -->
            <div class="bg-gray-800 border border-gray-600">
                <!-- Tab Headers -->
                <div class="flex border-b border-gray-600">
                    <button id="tab-network" class="tab-button active flex-1 px-4 py-3 text-white font-semibold hover:bg-gray-700 transition-all duration-300 border-b-2 border-green-400 cursor-default select-none bg-green-500/10 shadow-sm">
                        <i class="bi bi-diagram-3 me-2"></i>Network Defense Map
                    </button>
                    <button id="tab-alerts" class="tab-button flex-1 px-4 py-3 text-gray-400 font-semibold hover:bg-gray-700 hover:border-gray-500 transition-all duration-300 border-b-2 border-transparent cursor-pointer select-none active:translate-y-px active:bg-gray-600/20 shadow-sm">
                        <i class="bi bi-exclamation-triangle me-2"></i>Alert Center <span id="alerts-badge" class="hidden ms-2 px-2 py-0.5 bg-red-500 text-white text-xs rounded-full animate-pulse">0</span>
                    </button>
                    <button id="tab-incidents" class="tab-button flex-1 px-4 py-3 text-gray-400 font-semibold hover:bg-gray-700 hover:border-gray-500 transition-all duration-300 border-b-2 border-transparent cursor-pointer select-none active:translate-y-px active:bg-gray-600/20 shadow-sm">
                        <i class="bi bi-shield-exclamation me-2"></i>Incident Response <span id="incidents-badge" class="hidden ms-2 px-2 py-0.5 bg-yellow-500 text-black text-xs rounded-full animate-pulse">0</span>
                    </button>
                </div>
                
                <!-- Tab Content -->
                <div class="tab-content p-6">
                    <!-- Network Map Tab -->
                    <div id="content-network" class="tab-pane active">
                        <h3 class="text-lg font-semibold text-white mb-4 flex items-center">
                            <i class="bi bi-diagram-3 me-2 text-green-400"></i>Network Defense Map
                        </h3>
                    <div class="bg-black border border-gray-600 p-6">
                        <div id="network-map" class="space-y-4">
                            <!-- Interactive Network nodes -->
                            <div class="flex items-center justify-center space-x-8 flex-wrap mb-6">
                                <div class="network-node bg-gray-700 p-4 rounded-lg border-2 border-green-400 cursor-pointer hover:bg-gray-600 hover:-translate-y-0.5 hover:shadow-lg hover:shadow-green-500/30 active:translate-y-0 active:shadow-md active:shadow-green-500/20 transition-all duration-300 select-none shadow-sm shadow-black/30" data-asset="academy-server" onclick="window.gameController?.selectNetworkNode('academy-server')">
                                    <i class="bi bi-server text-green-400 text-xl"></i>
                                    <div class="text-xs font-mono font-bold mt-1 text-green-400">academy-server</div>
                                    <div class="text-xs text-gray-400 mb-1">(Academy Server)</div>
                                    <div class="w-full bg-gray-600 h-1 mt-1 rounded">
                                        <div class="bg-green-400 h-1 rounded" style="width: 100%"></div>
                                    </div>
                                    <div class="text-xs text-gray-300 mt-1 integrity-text">100% Integrity</div>
                                </div>
                                <div class="network-node bg-gray-700 p-4 rounded-lg border-2 border-green-400 cursor-pointer hover:bg-gray-600 hover:-translate-y-0.5 hover:shadow-lg hover:shadow-green-500/30 active:translate-y-0 active:shadow-md active:shadow-green-500/20 transition-all duration-300 select-none shadow-sm shadow-black/30" data-asset="student-db" onclick="window.gameController?.selectNetworkNode('student-db')">
                                    <i class="bi bi-database text-green-400 text-xl"></i>
                                    <div class="text-xs font-mono font-bold mt-1 text-green-400">student-db</div>
                                    <div class="text-xs text-gray-400 mb-1">(Student DB)</div>
                                    <div class="w-full bg-gray-600 h-1 mt-1 rounded">
                                        <div class="bg-green-400 h-1 rounded" style="width: 100%"></div>
                                    </div>
                                    <div class="text-xs text-gray-300 mt-1 integrity-text">100% Integrity</div>
                                </div>
                                <div class="network-node bg-gray-700 p-4 rounded-lg border-2 border-green-400 cursor-pointer hover:bg-gray-600 hover:-translate-y-0.5 hover:shadow-lg hover:shadow-green-500/30 active:translate-y-0 active:shadow-md active:shadow-green-500/20 transition-all duration-300 select-none shadow-sm shadow-black/30" data-asset="research-files" onclick="window.gameController?.selectNetworkNode('research-files')">
                                    <i class="bi bi-file-earmark-text text-green-400 text-xl"></i>
                                    <div class="text-xs font-mono font-bold mt-1 text-green-400">research-files</div>
                                    <div class="text-xs text-gray-400 mb-1">(Research Files)</div>
                                    <div class="w-full bg-gray-600 h-1 mt-1 rounded">
                                        <div class="bg-green-400 h-1 rounded" style="width: 100%"></div>
                                    </div>
                                    <div class="text-xs text-gray-300 mt-1 integrity-text">100% Integrity</div>
                                </div>
                                <div class="network-node bg-gray-700 p-4 rounded-lg border-2 border-green-400 cursor-pointer hover:bg-gray-600 hover:-translate-y-0.5 hover:shadow-lg hover:shadow-green-500/30 active:translate-y-0 active:shadow-md active:shadow-green-500/20 transition-all duration-300 select-none shadow-sm shadow-black/30" data-asset="learning-platform" onclick="window.gameController?.selectNetworkNode('learning-platform')">
                                    <i class="bi bi-mortarboard text-green-400 text-xl"></i>
                                    <div class="text-xs font-mono font-bold mt-1 text-green-400">learning-platform</div>
                                    <div class="text-xs text-gray-400 mb-1">(Learning Platform)</div>
                                    <div class="w-full bg-gray-600 h-1 mt-1 rounded">
                                        <div class="bg-green-400 h-1 rounded" style="width: 100%"></div>
                                    </div>
                                    <div class="text-xs text-gray-300 mt-1 integrity-text">100% Integrity</div>
                                </div>
                            </div>
                            <!-- Interactive Security controls -->
                            <div class="flex items-center justify-center space-x-8 mt-6">
                                <div class="security-control bg-gray-700 p-3 rounded border border-gray-600 cursor-pointer hover:bg-gray-600 hover:scale-105 hover:shadow-md hover:shadow-green-500/30 active:scale-98 transition-all duration-200 select-none shadow-sm shadow-black/30" data-control="firewall" onclick="window.gameController?.toggleSecurityControl('firewall')">
                                    <i class="bi bi-shield-check text-green-400"></i>
                                    <span class="text-xs text-white ms-2">Firewall</span>
                                </div>
                                <div class="security-control bg-gray-700 p-3 rounded border border-gray-600 cursor-pointer hover:bg-gray-600 hover:scale-105 hover:shadow-md hover:shadow-green-500/30 active:scale-98 transition-all duration-200 select-none shadow-sm shadow-black/30" data-control="endpoint" onclick="window.gameController?.toggleSecurityControl('endpoint')">
                                    <i class="bi bi-laptop text-green-400"></i>
                                    <span class="text-xs text-white ms-2">Endpoint Protection</span>
                                </div>
                                <div class="security-control bg-gray-700 p-3 rounded border border-gray-600 cursor-pointer hover:bg-gray-600 hover:scale-105 hover:shadow-md hover:shadow-green-500/30 active:scale-98 transition-all duration-200 select-none shadow-sm shadow-black/30" data-control="access" onclick="window.gameController?.toggleSecurityControl('access')">
                                    <i class="bi bi-key text-green-400"></i>
                                    <span class="text-xs text-white ms-2">Access Control</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    </div>
                    
                    <!-- Alert Center Tab -->
                    <div id="content-alerts" class="tab-pane hidden">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-white flex items-center">
                                <i class="bi bi-exclamation-triangle me-2 text-orange-400"></i>Alert Center
                            </h3>
                            <button id="mark-all-read" class="text-xs px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white rounded cursor-pointer transition-colors" onclick="window.gameController?.markAllAlertsRead()">
                                <i class="bi bi-check-all me-1"></i>Mark All Read
                            </button>
                        </div>
                        <div class="bg-blue-900/20 border border-blue-500/30 rounded-lg p-3 mb-4">
                            <p class="text-xs text-blue-200">
                                <i class="bi bi-lightbulb me-1 text-yellow-400"></i>
                                <strong>Tip:</strong> New alerts appear here when the Red Team AI attacks. Click an alert to mark it as read. Use terminal commands to investigate and respond to threats.
                            </p>
                        </div>
                        <div id="alert-center" class="space-y-3 security-content max-h-96 overflow-y-auto scrollbar-alerts">
                            <div class="text-sm text-gray-400 italic">No active alerts. Your network is currently secure.</div>
                        </div>
                    </div>
                    
                    <!-- Incident Response Tab -->
                    <div id="content-incidents" class="tab-pane hidden">
                        <h3 class="text-lg font-semibold text-white mb-4 flex items-center">
                            <i class="bi bi-shield-exclamation me-2 text-yellow-400"></i>Incident Response
                        </h3>
                        <div class="bg-yellow-900/20 border border-yellow-500/30 rounded-lg p-3 mb-4">
                            <p class="text-xs text-yellow-200">
                                <i class="bi bi-info-circle me-1 text-yellow-400"></i>
                                <strong>About Incidents:</strong> Critical attacks that need immediate action appear here. These represent successful breaches or compromised assets that require terminal commands to resolve.
                            </p>
                        </div>
                        <div id="incident-panel" class="space-y-3 security-content max-h-96 overflow-y-auto scrollbar-custom">
                            <div class="text-sm text-gray-400 italic">No incidents detected. All systems operating normally.</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Interactive Terminal (Full Width Below) -->
            <div class="bg-gray-800 border-2 border-gray-600 rounded-lg shadow-lg">
                <!-- Terminal Header -->
                <div class="flex items-center justify-between bg-gray-900 px-4 py-3 border-b-2 border-gray-600 rounded-t-lg">
                    <div class="flex items-center space-x-3">
                        <div class="flex space-x-2">
                            <div class="w-3 h-3 rounded-full bg-red-500"></div>
                            <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                            <div class="w-3 h-3 rounded-full bg-green-500"></div>
                        </div>
                        <h3 class="text-base font-bold text-green-400 flex items-center">
                            <i class="bi bi-terminal me-2"></i>Defense Command Terminal
                        </h3>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div class="text-xs text-gray-400 bg-gray-800 px-3 py-1.5 rounded border border-gray-700">
                            <i class="bi bi-keyboard me-1"></i>Type <span class="text-green-400 font-mono font-semibold">help</span> for commands
                        </div>
                        <button id="clear-terminal" class="text-xs px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-gray-300 hover:text-white rounded border border-gray-600 cursor-pointer transition-colors" onclick="window.gameController?.uiManager?.clearTerminal()">
                            <i class="bi bi-trash me-1"></i>Clear
                        </button>
                    </div>
                </div>
                
                <!-- Terminal Output Area -->
                <div id="terminal-output" class="bg-black text-green-400 font-mono p-4 overflow-y-auto scrollbar-terminal" style="min-height: 400px; max-height: 500px; font-size: 0.9rem; line-height: 1.6;">
                    <!-- Terminal content will be populated by JavaScript -->
                    <div id="response-actions" class="mt-2 hidden">
                        <div class="text-yellow-400">╔══ THREAT RESPONSE ACTIONS ══╗</div>
                        <div class="ms-2">
                            <button class="response-btn bg-gray-700 hover:bg-green-400 hover:text-black text-green-400 px-3 py-1 me-2 mt-1 rounded cursor-pointer" onclick="window.gameController?.executeResponse('block-ip')">1. Block IP</button>
                            <button class="response-btn bg-gray-700 hover:bg-green-400 hover:text-black text-green-400 px-3 py-1 me-2 mt-1 rounded cursor-pointer" onclick="window.gameController?.executeResponse('isolate-asset')">2. Isolate Asset</button>
                            <button class="response-btn bg-gray-700 hover:bg-green-400 hover:text-black text-green-400 px-3 py-1 me-2 mt-1 rounded cursor-pointer" onclick="window.gameController?.executeResponse('increase-monitoring')">3. Increase Monitoring</button>
                            <button class="response-btn bg-gray-700 hover:bg-green-400 hover:text-black text-green-400 px-3 py-1 me-2 mt-1 rounded cursor-pointer" onclick="window.gameController?.executeResponse('patch-vulnerability')">4. Patch Vulnerability</button>
                            <button class="response-btn bg-gray-700 hover:bg-green-400 hover:text-black text-green-400 px-3 py-1 me-2 mt-1 rounded cursor-pointer" onclick="window.gameController?.executeResponse('reset-credentials')">5. Reset Credentials</button>
                        </div>
                        <div class="text-yellow-400">╚════════════════════════════╝</div>
                    </div>
                </div>
                
                <!-- Terminal Input Area -->
                <div class="bg-gray-900 px-4 py-3 border-t-2 border-gray-600 rounded-b-lg">
                    <div class="flex items-center space-x-2">
                        <span class="text-green-400 font-mono font-bold text-lg select-none">$</span>
                        <input 
                            type="text" 
                            id="terminal-input" 
                            class="bg-gray-800 border border-gray-600 rounded px-3 py-2 text-green-400 font-mono flex-1 text-base outline-none cursor-text focus:border-green-500 focus:ring-2 focus:ring-green-500/30 transition-all duration-200" 
                            placeholder="Type a command and press Enter..."
                            autocomplete="off"
                            spellcheck="false">
                    </div>
                    <div class="mt-2 text-xs text-gray-500 flex items-center justify-between">
                        <div>
                            <i class="bi bi-lightbulb text-yellow-500 me-1"></i>
                            <span>Quick commands: <span class="text-green-400 font-mono">scan academy-server</span>, <span class="text-green-400 font-mono">status</span>, <span class="text-green-400 font-mono">restore student-db</span></span>
                        </div>
                        <div>
                            <i class="bi bi-arrow-return-left text-gray-600 me-1"></i>
                            <span>Press Enter to execute</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Game Over Modal -->
<div id="game-over-modal" class="fixed inset-0 bg-black/50 hidden z-50 flex items-center justify-center">
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-8 max-w-lg mx-4">
        <div class="text-center">
            <div id="game-result-icon" class="text-6xl mb-4"></div>
            <h2 id="game-result-title" class="text-2xl font-bold mb-4"></h2>
            <p id="game-result-message" class="text-gray-600 dark:text-gray-400 mb-6"></p>
            <div class="flex justify-center space-x-4">
                <button id="play-again" class="px-6 py-2 bg-green-400 text-black rounded-lg hover:bg-green-300 transition-colors cursor-pointer">
                    Play Again
                </button>
                <button id="close-modal" class="px-6 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors cursor-pointer">
                    Close
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block footer %}

{% endblock %}

{% block extra_js %}
<script>
// Tab switching functionality
document.addEventListener('DOMContentLoaded', () => {
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabPanes = document.querySelectorAll('.tab-pane');
    
    tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            const tabId = button.id.replace('tab-', '');
            
            // Remove active state from all buttons and panes
            tabButtons.forEach(btn => {
                btn.classList.remove('active', 'text-white', 'border-green-400', 'cursor-default', 'bg-green-500/10');
                btn.classList.add('text-gray-400', 'border-transparent', 'cursor-pointer');
            });
            tabPanes.forEach(pane => {
                pane.classList.remove('active');
                pane.classList.add('hidden');
            });
            
            // Add active state to clicked button and corresponding pane
            button.classList.add('active', 'text-white', 'border-green-400', 'cursor-default', 'bg-green-500/10');
            button.classList.remove('text-gray-400', 'border-transparent', 'cursor-pointer');
            const targetPane = document.getElementById(`content-${tabId}`);
            if (targetPane) {
                targetPane.classList.remove('hidden');
                targetPane.classList.add('active');
            }
        });
    });
    
    // Update alert badge when alerts change
    const updateAlertBadge = () => {
        const alertsCount = document.querySelectorAll('#alert-center > div:not(.italic)').length;
        const badge = document.getElementById('alerts-badge');
        if (badge) {
            if (alertsCount > 0) {
                badge.textContent = alertsCount;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }
    };
    
    // Update incidents badge when incidents change
    const updateIncidentsBadge = () => {
        const incidentsCount = document.querySelectorAll('#incident-panel > div:not(.italic)').length;
        const badge = document.getElementById('incidents-badge');
        if (badge) {
            if (incidentsCount > 0) {
                badge.textContent = incidentsCount;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }
    };
    
    // Monitor alert center for changes
    const alertCenter = document.getElementById('alert-center');
    if (alertCenter) {
        const observer = new MutationObserver(updateAlertBadge);
        observer.observe(alertCenter, { childList: true, subtree: true });
    }
    
    // Monitor incident panel for changes
    const incidentPanel = document.getElementById('incident-panel');
    if (incidentPanel) {
        const observer = new MutationObserver(updateIncidentsBadge);
        observer.observe(incidentPanel, { childList: true, subtree: true });
    }
    
    // Auto-focus terminal input for better UX
    const terminalInput = document.getElementById('terminal-input');
    if (terminalInput) {
        // Focus after a short delay to ensure page is loaded
        setTimeout(() => {
            terminalInput.focus();
        }, 500);
        
        // Keep terminal input accessible - click anywhere on output to focus input
        const terminalOutput = document.getElementById('terminal-output');
        if (terminalOutput) {
            terminalOutput.addEventListener('click', () => {
                terminalInput.focus();
            });
        }
    }
});
</script>
<script type="module" src="{{ url_for('static', filename='js/blue-team-vs-red-team-mode/game-controller.js') }}"></script>
<script type="module" src="{{ url_for('static', filename='js/blue-team-vs-red-team-mode/ai-engine.js') }}"></script>
<script type="module" src="{{ url_for('static', filename='js/blue-team-vs-red-team-mode/ui-manager.js') }}"></script>
{% endblock %}
