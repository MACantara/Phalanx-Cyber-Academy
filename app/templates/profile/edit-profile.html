{% extends "base.html" %}

{% block title %}Edit Profile{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <div class="bg-white dark:bg-gray-800 shadow-xl rounded-lg overflow-hidden">
        <div class="px-6 py-8">
            <div class="flex items-center justify-between mb-8 opacity-0 animate-fade-in-up">
                <div class="flex items-center space-x-4">
                    <div class="h-12 w-12 flex items-center justify-center rounded-full bg-blue-100 dark:bg-blue-900/30 animate-pulse-slow">
                        <i class="bi bi-pencil-square text-blue-600 dark:text-blue-400 text-2xl"></i>
                    </div>
                    <h1 class="text-3xl font-bold text-gray-900 dark:text-white">
                        Edit Profile
                    </h1>
                </div>
                <a href="{{ url_for('profile.profile') }}" 
                   class="group inline-flex items-center px-4 py-2 bg-gradient-to-r from-gray-600 to-gray-700 text-white font-semibold rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-gray-500/25 shadow-md hover:shadow-lg hover:scale-105 transform">
                    <i class="bi bi-arrow-left mr-2"></i>
                    Back to Profile
                </a>
            </div>

            <form method="POST" class="space-y-6 opacity-0 animate-fade-in-left" style="animation-delay: 0.1s;">
                <input type="hidden" id="csrf_token" name="csrf_token" value="{{csrf_token()}}">
                <!-- Username -->
                <div class="opacity-0 animate-fade-in-up" style="animation-delay: 0.2s;">
                    <label for="username" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                        Username
                    </label>
                    <input type="text" id="username" name="username" required
                           class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300 bg-white dark:bg-gray-800 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 hover:shadow-md"
                           placeholder="Enter your username" value="{{ user.username }}">
                    <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">3-30 characters, letters, numbers and underscores only</p>
                </div>

                <!-- Email -->
                <div class="opacity-0 animate-fade-in-up" style="animation-delay: 0.3s;">
                    <label for="email" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                        Email Address
                    </label>
                    <input type="email" id="email" name="email" required
                           class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300 bg-white dark:bg-gray-800 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 hover:shadow-md"
                           placeholder="Enter your email address" value="{{ user.email }}">
                </div>

                <!-- Timezone -->
                <div class="opacity-0 animate-fade-in-up" style="animation-delay: 0.35s;">
                    <label for="timezone" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                        Timezone
                    </label>
                    <select id="timezone" name="timezone" 
                            class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300 bg-white dark:bg-gray-800 text-gray-900 dark:text-white hover:shadow-md">
                        {% set current_timezone = user.timezone if user.timezone else 'UTC' %}
                        
                        <!-- UTC and Common -->
                        <optgroup label="Universal / Common">
                            {% for tz in common_timezones %}
                                {% if tz in ['UTC', 'Etc/UTC', 'GMT', 'Etc/GMT'] %}
                                    <option value="{{ tz }}" {% if tz == current_timezone %}selected{% endif %}>{{ tz }}</option>
                                {% endif %}
                            {% endfor %}
                        </optgroup>
                        
                        <!-- Africa -->
                        <optgroup label="Africa">
                            {% for tz in common_timezones %}
                                {% if tz.startswith('Africa/') %}
                                    <option value="{{ tz }}" {% if tz == current_timezone %}selected{% endif %}>{{ tz.replace('Africa/', '') }}</option>
                                {% endif %}
                            {% endfor %}
                        </optgroup>
                        
                        <!-- Americas -->
                        <optgroup label="Americas">
                            {% for tz in common_timezones %}
                                {% if tz.startswith('America/') %}
                                    <option value="{{ tz }}" {% if tz == current_timezone %}selected{% endif %}>{{ tz.replace('America/', '') }}</option>
                                {% endif %}
                            {% endfor %}
                        </optgroup>
                        
                        <!-- Antarctica -->
                        <optgroup label="Antarctica">
                            {% for tz in common_timezones %}
                                {% if tz.startswith('Antarctica/') %}
                                    <option value="{{ tz }}" {% if tz == current_timezone %}selected{% endif %}>{{ tz.replace('Antarctica/', '') }}</option>
                                {% endif %}
                            {% endfor %}
                        </optgroup>
                        
                        <!-- Arctic -->
                        <optgroup label="Arctic">
                            {% for tz in common_timezones %}
                                {% if tz.startswith('Arctic/') %}
                                    <option value="{{ tz }}" {% if tz == current_timezone %}selected{% endif %}>{{ tz.replace('Arctic/', '') }}</option>
                                {% endif %}
                            {% endfor %}
                        </optgroup>
                        
                        <!-- Asia -->
                        <optgroup label="Asia">
                            {% for tz in common_timezones %}
                                {% if tz.startswith('Asia/') %}
                                    <option value="{{ tz }}" {% if tz == current_timezone %}selected{% endif %}>{{ tz.replace('Asia/', '') }}</option>
                                {% endif %}
                            {% endfor %}
                        </optgroup>
                        
                        <!-- Atlantic -->
                        <optgroup label="Atlantic">
                            {% for tz in common_timezones %}
                                {% if tz.startswith('Atlantic/') %}
                                    <option value="{{ tz }}" {% if tz == current_timezone %}selected{% endif %}>{{ tz.replace('Atlantic/', '') }}</option>
                                {% endif %}
                            {% endfor %}
                        </optgroup>
                        
                        <!-- Australia -->
                        <optgroup label="Australia">
                            {% for tz in common_timezones %}
                                {% if tz.startswith('Australia/') %}
                                    <option value="{{ tz }}" {% if tz == current_timezone %}selected{% endif %}>{{ tz.replace('Australia/', '') }}</option>
                                {% endif %}
                            {% endfor %}
                        </optgroup>
                        
                        <!-- Europe -->
                        <optgroup label="Europe">
                            {% for tz in common_timezones %}
                                {% if tz.startswith('Europe/') %}
                                    <option value="{{ tz }}" {% if tz == current_timezone %}selected{% endif %}>{{ tz.replace('Europe/', '') }}</option>
                                {% endif %}
                            {% endfor %}
                        </optgroup>
                        
                        <!-- Indian Ocean -->
                        <optgroup label="Indian Ocean">
                            {% for tz in common_timezones %}
                                {% if tz.startswith('Indian/') %}
                                    <option value="{{ tz }}" {% if tz == current_timezone %}selected{% endif %}>{{ tz.replace('Indian/', '') }}</option>
                                {% endif %}
                            {% endfor %}
                        </optgroup>
                        
                        <!-- Pacific -->
                        <optgroup label="Pacific">
                            {% for tz in common_timezones %}
                                {% if tz.startswith('Pacific/') %}
                                    <option value="{{ tz }}" {% if tz == current_timezone %}selected{% endif %}>{{ tz.replace('Pacific/', '') }}</option>
                                {% endif %}
                            {% endfor %}
                        </optgroup>
                        
                        <!-- Legacy/Country Codes -->
                        <optgroup label="Legacy / Country Codes">
                            {% for tz in common_timezones %}
                                {% if not (tz.startswith('Africa/') or tz.startswith('America/') or tz.startswith('Antarctica/') or 
                                          tz.startswith('Arctic/') or tz.startswith('Asia/') or tz.startswith('Atlantic/') or 
                                          tz.startswith('Australia/') or tz.startswith('Europe/') or tz.startswith('Indian/') or 
                                          tz.startswith('Pacific/') or tz.startswith('Etc/') or tz in ['UTC', 'GMT']) %}
                                    <option value="{{ tz }}" {% if tz == current_timezone %}selected{% endif %}>{{ tz }}</option>
                                {% endif %}
                            {% endfor %}
                        </optgroup>
                        
                        <!-- Etc/GMT Offsets -->
                        <optgroup label="GMT Offsets">
                            {% for tz in common_timezones %}
                                {% if tz.startswith('Etc/') and tz not in ['Etc/UTC', 'Etc/GMT'] %}
                                    <option value="{{ tz }}" {% if tz == current_timezone %}selected{% endif %}>{{ tz }}</option>
                                {% endif %}
                            {% endfor %}
                        </optgroup>
                    </select>
                    <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Times will be displayed in your selected timezone</p>
                </div>

                <!-- Submit Button -->
                <div class="opacity-0 animate-fade-in-up" style="animation-delay: 0.5s;">
                    <button type="submit" id="profile-btn"
                            class="group w-full inline-flex items-center justify-center px-8 py-4 bg-gradient-to-r from-green-600 to-teal-600 text-white font-semibold text-lg rounded-xl hover:from-green-700 hover:to-teal-700 transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-green-500/25 shadow-xl hover:shadow-2xl hover:scale-105 transform cursor-pointer">
                        <i class="bi bi-check-circle mr-3 submit-icon"></i>
                        <div class="hidden animate-spin submit-spinner">
                            <i class="bi bi-arrow-clockwise"></i>
                        </div>
                        <span class="submit-text">Update Profile</span>
                        <span class="hidden submit-loading-text">Updating Profile...</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
{% endblock %}